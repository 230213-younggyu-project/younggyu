<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.korit.younggyu.plant.repository.PlantRepository">
    <select id="getPlantEntity" resultType="com.korit.younggyu.plant.entity.TotalPlantEntity">
        select
            count(id) as totalPlant,
            sum(capacity)as totalCapacity
        from
            plant_list;
    </select>

    <select id="getBusiness" resultType="com.korit.younggyu.plant.entity.BusinessEntity">
        select
            business,
            count(business) as businessCount
        from
            plant_list
        group by
            business;
    </select>

    <select id="getTotalCpgEntity" resultType="com.korit.younggyu.plant.entity.TotalCpgEntity">
        select
            sum(todayCpg) as totalTpg,
            sum(todayCpg) * 30 as totalMpg,
            sum(maxCpg) as totalCpg
        from
            (select
                plant_id,
                code,
                max(cpg) - min(cpg) as todayCpg,
                max(cpg) as maxCpg
            from
                plant_data
            group by
                plant_id,
                code) temp_plant_data
    </select>

    <select id="getState" resultType="com.korit.younggyu.plant.entity.StateEntity">
        select
            state,
            count(state) as stateCount
        from
            plant_list
        group by
            state;
    </select>
</mapper>

